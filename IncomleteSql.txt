DROP TABLE EXTRA-PROGRAM;
DROP TABLE SPECIAL-OFFERS;
DROP TABLE GAME;
DROP TABLE GAMECOMPANY;
DROP TABLE PERSON;
DROP TABLE COMMUNITY;
DROP TABLE USER1;
DROP TABLE ADMIN;
DROP TABLE SALES;
DROP TABLE DISCOUNT;

CREATE TABLE PERSON(
PID NUMBER(10),
TNO NUMBER(15),
PNAME VARCHAR2(15) NOT NULL,
PMAIL VARCHAR2(25),
PBIRTHDAY DATE,
UNIQUE(PNAME),
UNIQUE(PMAIL),
CONSTRAINT USER_PID_pk PRIMARY KEY(PID));

INSERT INTO PERSON VALUES
(1,05344168919,'BAHADIR','bahadiryurdakul@gmail.com',TO_DATE('10-APR-1995', 'DD-MON-YYYY'));

INSERT INTO PERSON VALUES
(2,05239999999,'SADIK','talansadik@gmail.com',TO_DATE('28-MAY-1992', 'DD-MON-YYYY'));

SELECT p.pname,ABS( (SYSDATE-p.PBIRTHDAY) / 365 ) "age"
FROM PERSON p;     //AGE BULMAK ICIN(abs niye çalýþmýyor).

CREATE TABLE ADMIN(
PID NUMBER(10),
COMID NUMBER(10),
FOREIGN KEY(PID) REFERENCES PERSON(PID),
PRIMARY KEY(COMID)
);  --THERE IS ONLY ONE ADMIN FOR EVERY COMMUNITY.


CREATE TABLE COMMUNITY(
COMID NUMBER(10),
COMNAME VARCHAR2(20) NOT NULL,
FOREIGN KEY(COMID) REFERENCES ADMIN(COMID),
UNIQUE(COMNAME),
PRIMARY KEY(COMID));

CREATE TABLE SUBSCRIBES(
ID NUMBER(10),
PID NUMBER(10),
COMID NUMBER(10),  
FOREIGN KEY(PID) REFERENCES PERSON(PID),
FOREIGN KEY(COMID) REFERENCES ADMIN(COMID),
UNIQUE(PID,COMID),
PRIMARY KEY(ID)
);


INSERT INTO ADMIN VALUES(1,101);
INSERT INTO SUBSCRIBES VALUES(1,1,101);

INSERT INTO ADMIN VALUES(1,102);
INSERT INTO SUBSCRIBES VALUES(2,1,102);

INSERT INTO SUBSCRIBES VALUES(3,2,101); --NOT IN ADMIN : USER o yüzden user oluþturmaya gerek yok.

INSERT INTO SUBSCRIBES VALUES(4,2,102);

SELECT s.pid,s.comid
FROM SUBSCRIBES s
WHERE (s.pid,s.comid) NOT IN(
                    SELECT a.pid,a.comid
                    FROM ADMIN a);

INSERT INTO COMMUNITY VALUES
(101,'CS-GO');
INSERT INTO COMMUNITY VALUES
(102,'LEAGUE OF LEGENDS');

SELECT s.pid,s.comid,c.comname
FROM SUBSCRIBES s,COMMUNITY c
WHERE (s.pid,s.comid) NOT IN(
                    SELECT a.pid,a.comid
                    FROM ADMIN a)
      AND
        s.comid = c.comid
ORDER BY S.COMID;            --USER LISTESINI COMIDLERLE BÝRLÝKTE VERÝR.

CREATE TABLE GAMECOMPANY(
CID NUMBER(10),
CNAME VARCHAR2(20) NOT NULL,
TELNO NUMBER(15),
EMAIL VARCHAR2(20),
URL VARCHAR2(20),
UNIQUE(CNAME),
PRIMARY KEY(CID));

INSERT INTO GAMECOMPANY VALUES(
50,'UBISOFT',021624881,'ubisoft@gmail.com','ubisoft.com');

CREATE TABLE GAME(
CID NUMBER(10),
gameId NUMBER(10),
gameName VARCHAR2(20) NOT NULL,
price NUMBER(10) NOT NULL,
genre VARCHAR2(15),
ageLimit VARCHAR2(5),
releaseDate DATE,
PRIMARY KEY(gameId),
UNIQUE(gameName),
FOREIGN KEY(CID) REFERENCES GAMECOMPANY(CID)
);

INSERT INTO GAME VALUES(
50,100,'HITMAN',200,'ASSASSIN','+13',SYSDATE);

CREATE TABLE EXTRAPROGRAM(
programid NUMBER(10),
gameId NUMBER(10),
programname VARCHAR2(20) NOT NULL,
programprice NUMBER(10) NOT NULL,
releasedate DATE,
FOREIGN KEY(gameId) REFERENCES GAME(gameID),
UNIQUE(programname),
PRIMARY KEY(programid));

INSERT INTO EXTRAPROGRAM VALUES(
1,100,'sight',25,SYSDATE);

select e.programname,g.gamename,e.programprice,g.price,e.programprice + g.price "total price"
from EXTRAPROGRAM e,game g
WHERE g.gameýd=e.gameýd;  --BAÐLANTILI OLAN OYUNLAR VE EXTRAPROGRAM GÖSTERÝMÝ

CREATE TABLE SALES(SID NUMBER(10),
PRIMARY KEY(SID));


CREATE TABLE SALESGame(
SID NUMBER(10),
productID NUMBER(10) NOT NULL,
purchaseDate DATE,
PID NUMBER(10),
COST NUMBER(10) NOT NULL,
PRIMARY KEY(SID),
FOREIGN KEY(SID) REFERENCES SALES(SID),
FOREIGN KEY(PID) REFERENCES PERSON(PID),
FOREIGN KEY(productID) REFERENCES game(gameID));


CREATE TABLE SALESPROGRAM(
SID NUMBER(10),
productID NUMBER(10) NOT NULL,
purchaseDate DATE,
PID NUMBER(10),
COST NUMBER(10) NOT NULL,
PRIMARY KEY(SID),
FOREIGN KEY(SID) REFERENCES SALES(SID),
FOREIGN KEY(PID) REFERENCES PERSON(PID),
FOREIGN KEY(productID) REFERENCES EXTRAPROGRAM(programid));

INSERT INTO SALES VALUES(1);
INSERT INTO SALESProgram VALUES(1,1,SYSDATE,1,200);

INSERT INTO SALES VALUES(2);
INSERT INTO SALESGame VALUES(2,100,SYSDATE,1,200);

SELECT SUM(p.cost),e.programname
FROM SALESProgram p,EXTRAPROGRAM e
WHERE p.productid=e.programid
GROUP BY e.programname;  --SATILAN PROGRAM LÝSTESÝNDE PROGRAMLARIN TOPLAM SATIÞ DEÐERÝ.


CREATE TABLE GROUPOFFERS(
LowRate NUMBER(3),
HighRate NUMBER(3),
OfferCategory NUMBER(3),
PRIMARY KEY(OfferCategory));

INSERT INTO GROUPOFFERS VALUES(10,20,1);
INSERT INTO GROUPOFFERS VALUES(20,30,2);
INSERT INTO GROUPOFFERS VALUES(30,40,3);


CREATE TABLE DISCOUNT(
ID NUMBER(10),
OfferRate VARCHAR2(4),
PRIMARY KEY(ID));

CREATE TABLE DISCOUNTGAME(
ID NUMBER(10),
productID NUMBER(10) NOT NULL,
FOREIGN KEY(productID) REFERENCES game(gameID),
FOREIGN KEY(ID) REFERENCES DISCOUNT(ID),
UNIQUE(productID),
PRIMARY KEY(ID));


CREATE TABLE DISCOUNTPROGRAM(
ID NUMBER(10),
productID NUMBER(10) NOT NULL,
FOREIGN KEY(productID) REFERENCES EXTRAPROGRAM(programID),
FOREIGN KEY(ID) REFERENCES DISCOUNT(ID),
UNIQUE(productID),
PRIMARY KEY(ID));

INSERT INTO DISCOUNT VALUES(1,22);
INSERT INTO DISCOUNTGAME VALUES(1,100);  -%22,productid=100

INSERT INTO DISCOUNT VALUES(2,13);        
INSERT INTO DISCOUNTPROGRAM VALUES(2,1);  -%13 ,productid=1

SELECT 	g.gamename, o.offercategory
FROM	GROUPOFFERS o,   DISCOUNTGAME d,game g,DISCOUNT z
WHERE   d.id=z.id AND
	            z.offerrate   BETWEEN o.lowrate AND o.highrate 
                  AND
d.productid=g.gameid;    --DISCOUNTGAME KATEGORILERI

SELECT d.id,p.productID  "program id",g.productID  "game id",a.gameName,b.programname,d.offerrate
FROM DISCOUNTPROGRAM p , DISCOUNT d, DISCOUNTGAME g,GAME a,EXTRAPROGRAM b
WHERE d.id=g.id OR d.id=p.id